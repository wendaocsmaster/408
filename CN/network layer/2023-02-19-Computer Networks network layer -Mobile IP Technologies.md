---
layout: post
title: 计算机网络网络层移动IP技术
categories: [计算机网络]
description: 网络层
keywords: computer networks network layer 
---

## 移动IP技术

1. 移动IP技术解决了用户在移动过程中不断切换网路而不停改变IP地址，导致不能顺利下载网络文件的问题。

2. 系统IP涉及到的概念

   + 归属网络：每个移动的主机都有一个默认连接的网络或者初始申请接入的网络，叫做归属网络（Home Network）
   + 归属地址：移动个主机在归属网络中的IP地址在其整个移动通信过程中是时钟不变的，因此称为永久地址（Permanent Address）或者归属地址（Home Address）
   + 归属代理：在归属网络中，代表移动主机执行移动管理功能的实体称为归属代理（Home Agent）。归属代理通常是连接在归属网络上的路由器，它作为代理的功能则是在网络层完成的。
   + 外地网络：移动主机当前漫游躲所在的网络称为外地网络（Foreign Network）或者被访网络（Visited Network）
   + 外地代理：在外地网络中，帮助主机执行移动管理功能的实体称为外地代理（Foreign Agent）
   + 转交地址：外地代理通常就是连接在外地网络上的路由器，外地代理会给移动主机提供一个临时使用的属于外地网络的转交地址（Care-of Address）。

3. 工作过程

   + 代理发现和注册

     移动主机通过自己的代理发现协议与外地代理建立连接，外地代理给移动个主机分配一个IP地址作为转交地址，同时外地代理注册自己的归属IP地址和归属代理地址，外地代理收到移动主机的归属地址和归属代理地址后，将移动主机的归属地址记录在自己的注册表中，同时向移动主机的归属代理注册该移动主机的转交地址（也可以由移动主机直接进行注册），移动主机的归属代理收到移动外地代理或移动主机对转交地址的注册后，将移动主机的转交地址记录下来，此后归属代理会代替移动主机接收发送给该移动主机的所有IP数据报，并利用IP隧道技术将这些IP数据报发送给外地网络中的移动主机。

     + 移动主机向外地代理注册自己的归属IP地址和归属代理，并获取转交地址
       ![image-20230221210419382](https://wendaocsmaster.github.io/images/blog/image-20230221210419382.png)

     + 外地代理或者主机向归属代理注册注册转交地址，并使用IP隧道技术转发IP数据报

       ![image-20230221210533339](https://wendaocsmaster.github.io/images/blog/image-20230221210533339.png)
     + 当移动主机不在归属网络时，归属代理会以自己的MAC地址应答所有对于该移动主机的ARP请求，即归属代理使用ARP代理技术。为了使归属网络中其他个主机和路由器尽快更新各自的ARP告诉缓存，归属代理还会主动发送广播，并声称自己是该移动主机。因此所有发送给该移动主机的所有IP数据报都会经过归属代理转发。

     

   + 移动主机向固定主机发送IP数据报

     ![image-20230221211652145](https://wendaocsmaster.github.io/images/blog/image-20230221211652145.png)

     当移动主机向固定主机发送IP数据报时候，IP路由器并不关心IP数据报的源地址，只需要根据IP数据报中的目的地址将IP数据报正确转发出去即可，无需通过归属代理。此时移动主机可以将外地代理作为自己的默认路由器，也可以使用代理发现协议获取外地网络中其他路由器的地址，并将其设置为自己的默认路由器。

   + 固定主机向移动主机发送IP数据报

     ![image-20230221210720613](https://wendaocsmaster.github.io/images/blog/image-20230221210720613.png)

     当外地代理和移动主机不是同一个设备时，转交地址实际上是外地代理的地址而不是移动主机的地址，转交地址既不会作为移动主机发送IP数据报的源地址，也不会作为移动主机所接受的数据报的目的地址。

     转交地址仅仅是归属代理到外地代理的IP隧道出口地址

     所有使用同一外地代理的移动主机可以共享同一个转交地址

     当外地代理从IP隧道中收到并解封出原IP数据报时候，会在自己的代理注册表中查找移动主机的归属地址所对应的MAC地址，并将该数据报封装到目的地址为该MAC地址的帧中发送给移动主机。

   + 同址转交地址

     移动主机上需要运行额外的外地代理软件，外地网络也需要提供相应的机制，使移动主机能够自动获取一个外地网络中的地址作为自己的IP地址和外地代理地址，被称为同址转交地址（Co-Located Care-of Address）

4. 通信三角问题

   ![image-20230221212958008](https://wendaocsmaster.github.io/images/blog/image-20230221212958008.png)

## 参考资料

[深入浅出计算机网络（微课视频版）](http://www.tup.tsinghua.edu.cn/booksCenter/book_09342101.html)

![img](https://wendaocsmaster.github.io/images/blog/093421-01.jpg)
